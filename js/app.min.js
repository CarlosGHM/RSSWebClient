var rssClientApp=angular.module("rssClient",[]);rssClientApp.controller("FeedBackController",["$scope","feedbackService","podcastPlayerService","messageService",function(e,t,r,s){e.podcastList=[],e.requestOnProcess=!1,e.getPodcastFeedback=function(){e.requestOnProcess=!0,t.getFeedback(e.feedbackUrl).then(function(o){r.addPodcast(t.getPodcastInfo(o)),e.podcastList=r.getPodcastList(),s.showMessage({message:"Podcast agregado correctamete",isCustomMessage:!0},s.okMessage)})["catch"](function(r){t.removePodcastUrl(e.feedbackUrl),s.showMessage(r,s.errorMessage)})["finally"](function(){e.feedbackUrl="",e.requestOnProcess=!1})},e.playPodcast=function(e,t){r.playPodcast(e,t.currentTarget)}}]),rssClientApp.factory("feedbackService",["$q","$http",function(e,t){function r(e){var t="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'"+encodeURIComponent(e)+"'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK";return t}function s(e){return e.data.query.results.rss.channel}function o(e){var t=[];return e.item.forEach(function(e,r){var s={url:void 0!==e.enclosure&&void 0!==e.enclosure.url?e.enclosure.url:"",type:void 0!==e.enclosure.type?e.enclosure.type:"Sin tipo",title:void 0!==e.title?e.title:"Sin titulo",description:void 0!==e.description?e.description:"Sin descripción",pubDate:void 0!==e.pubDate?e.pubDate:"Sin fecha de publicación"};""!==s.url&&t.push(s)}),{index:0,title:void 0!==e.title?e.title:"Sin titulo",author:void 0!==e.author?e.author:"Autor desconocido",chapters:t}}function a(s){if(i.has(s)){var o=e.defer();return o.reject({message:"El podcast ya está registrado",isCustomMessage:!0}),o.promise}return i.add(s),t.jsonp(r(s))}function n(e){return o(s(e))}function c(e){i["delete"](e)}var i=new Set;return{getFeedback:function(e){return a(e)},getPodcastInfo:function(e){return n(e)},removePodcastUrl:function(e){c(e)}}}]),rssClientApp.factory("podcastPlayerService",["$compile",function(e){function t(e){return'<div class="col-lg-12"><h3>Estas escuchando...</h3><br/></div><div class="col-lg-12"><h4>'+e.title+'</h4><br/></div><div class="col-lg-12 podcast-desc">'+e.description+'<br/><br/></div><div class="col-lg-12 podcast-audio-tag"><audio autoplay="true" controls="controls"><source src="'+e.url+'" customAudioEvents></source>Tu navegador no soporta el elemento <code>Audio</code>.</audio></div>'}function r(r,s){var o=angular.element(document.querySelector("#newElementDiv")),n=e(t(r))(o.scope());o.html(n),null!==a&&a.addClass("not-playing"),a=angular.element(s),a.addClass("playing")}function s(e){e.index=o.length,o.push(e)}var o=[],a=null;return{addPodcast:function(e){s(e)},getPodcastList:function(){return o},playPodcast:function(e,t){r(e,t)}}}]),rssClientApp.factory("messageService",["$compile",function(e){function t(e,t){return'<div class="alert '+t+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>"}function r(e){return e.isCustomMessage?e.message:"Ocurrió un problema al cargar la información"}function s(s,n){var c="";switch(n){case o:c=t(r(s),"alert-success");break;case a:c=t(r(s),"alert-warning")}var i=angular.element(document.querySelector("#messageContainer")),l=e(c)(i.scope());i.html(l)}var o="Ok",a="Error";return{showMessage:function(e,t){s(e,t)},okMessage:o,errorMessage:a}}]);