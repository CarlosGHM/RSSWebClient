var rssClientApp=angular.module("rssClient",[]);rssClientApp.controller("FeedBackController",["$scope","feedbackService","podcastPlayerService","messageService",function(e,t,s,r){e.podcastList=[],e.requestOnProcess=!1,e.getPodcastFeedback=function(){e.requestOnProcess=!0,t.getFeedback(e.feedbackUrl).then(function(a){s.addPodcast(t.getPodcastInfo(a)),e.podcastList=s.getPodcastList(),r.showMessage({message:"Podcast agregado correctamete",isCustomMessage:!0},r.okMessage)})["catch"](function(s){t.removePodcastUrl(e.feedbackUrl),r.showMessage(s,r.errorMessage)})["finally"](function(){e.feedbackUrl="",e.requestOnProcess=!1})},e.playPodcast=function(e,t){s.playPodcast(e,t.currentTarget)}}]),rssClientApp.factory("feedbackService",["$q","$http",function(e,t){function s(e){var t="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'"+encodeURIComponent(e)+"'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK";return t}function r(e){return e.data.query.results.rss.channel}function a(e){var t=[];return e.item.forEach(function(e,s){t.push({title:e.title,description:e.description,pubDate:e.pubDate,url:e.enclosure.url,type:e.enclosure.type})}),{index:0,title:e.title,author:e.author,imageUrl:e.image[0].href,chapters:t}}function o(r){if(i.has(r)){var a=e.defer();return a.reject({message:"El podcast ya está registrado",isCustomMessage:!0}),a.promise}return i.add(r),t.jsonp(s(r))}function n(e){return a(r(e))}function c(e){i["delete"](e)}var i=new Set;return{getFeedback:function(e){return o(e)},getPodcastInfo:function(e){return n(e)},removePodcastUrl:function(e){c(e)}}}]),rssClientApp.factory("messageService",["$compile",function(e){function t(e,t){return'<div class="alert '+t+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>"}function s(e){return e.isCustomMessage?e.message:"Ocurrió un problema al cargar la información"}function r(r,n){var c="";switch(n){case a:c=t(s(r),"alert-success");break;case o:c=t(s(r),"alert-warning")}var i=angular.element(document.querySelector("#messageContainer")),l=e(c)(i.scope());i.html(l)}var a="Ok",o="Error";return{showMessage:function(e,t){r(e,t)},okMessage:a,errorMessage:o}}]),rssClientApp.factory("podcastPlayerService",["$compile",function(e){function t(e){return'<div class="col-lg-12"><h3>Estas escuchando...</h3><br/></div><div class="col-lg-12"><h4>'+e.title+'</h4><br/></div><div class="col-lg-12 podcast-desc">'+e.description+'<br/><br/></div><div class="col-lg-12 podcast-audio-tag"><audio autoplay="true" controls="controls"><source src="'+e.url+'" customAudioEvents></source>Tu navegador no soporta el elemento <code>Audio</code>.</audio></div>'}function s(s,r){var a=angular.element(document.querySelector("#newElementDiv")),n=e(t(s))(a.scope());a.html(n),null!==o&&o.addClass("not-playing"),o=angular.element(r),o.addClass("playing")}function r(e){e.index=a.length,a.push(e)}var a=[],o=null;return{addPodcast:function(e){r(e)},getPodcastList:function(){return a},playPodcast:function(e,t){s(e,t)}}}]);